<!-- おかえりなさい -->
<section class="mb-4">
  <h1 class="text-2xl text-black [font-family:'Rounded_Mplus_1c-Black',Helvetica]">
    おかえりなさい！
  </h1>
</section>

<!-- 帰宅ボタン -->
<section class="mb-6 w-full">
  <% if @today_session&.return_home_at.blank? %>
    <%= button_to "帰宅", return_home_daily_sessions_path,
        method: :post,
        class: "block w-full bg-[#67c2fa] rounded-xl py-3 text-2xl font-medium text-black shadow-sm hover:bg-[#4eb3f7] transition-colors text-center [font-family:'Rounded_Mplus_1c-Medium',Helvetica]" %>
  <% else %>
    <button disabled
      class: "block w-full bg-gray-300 rounded-xl py-3 text-2xl font-medium text-black shadow-sm cursor-not-allowed text-center [font-family:'Rounded_Mplus_1c-Regular',Helvetica]">
      帰宅済み
    </button>
  <% end %>
</section>

<!-- 嫌なことを終わらせよう -->
<section class="mb-4">
  <h2 class="text-2xl text-black [font-family:'Rounded_Mplus_1c-Black',Helvetica]">
    嫌なことを終わらせよう！
  </h2>
</section>

<!-- 習慣ボタン群 -->
<div class="flex flex-col w-full mb-8">
  <% if @today_session&.return_home_at.blank? %>
    <!-- 帰宅前：グレーアウト＆押せない -->
    <div class="opacity-50 cursor-not-allowed">
      <div class="flex flex-col w-full [&>*+*]:mt-4">
        <% @habits.each do |habit| %>
          <button disabled
            class="block w-full bg-gray-300 border border-gray-300 rounded-xl py-3 text-2xl font-medium text-black shadow-sm text-center [font-family:'Rounded_Mplus_1c-Regular',Helvetica]">
            <%= habit.title %>
          </button>
        <% end %>
        <button disabled
          class="block w-full bg-gray-300 border border-gray-300 rounded-xl py-3 text-2xl font-medium text-black shadow-sm text-center [font-family:'Rounded_Mplus_1c-Regular',Helvetica]">
          + 習慣を追加
        </button>
      </div>
    </div>

  <% elsif @today_session&.bedtime_at.present? %>
    <!-- 💤 就寝済み：押せない -->
    <div class="opacity-50 cursor-not-allowed">
      <div class="flex flex-col w-full [&>*+*]:mt-4">
        <% @habits.each do |habit| %>
          <button disabled
            class="block w-full bg-gray-300 border border-gray-300 rounded-xl py-3 text-2xl font-medium text-black shadow-sm text-center [font-family:'Rounded_Mplus_1c-Regular',Helvetica]">
            <%= habit.title %>
          </button>
        <% end %>
        <button disabled
          class="block w-full bg-gray-300 border border-gray-300 rounded-xl py-3 text-2xl font-medium text-black shadow-sm text-center [font-family:'Rounded_Mplus_1c-Regular',Helvetica]">
          🔒 本日は就寝済みです
        </button>
      </div>
    </div>

  <% else %>
    <!-- 🌞 帰宅後＆未就寝：押せる -->
    <div class="flex flex-col w-full [&>*+*]:mt-4">
      <% @habits.each do |habit| %>
        <%= render partial: "habit_button", locals: { habit: habit } %>
      <% end %>

      <%= link_to new_habit_path,
        class: "block w-full bg-white border border-gray-300 rounded-xl py-3 text-2xl font-medium text-black shadow-sm hover:bg-gray-100 transition-colors text-center [font-family:'Rounded_Mplus_1c-Regular',Helvetica]" do %>
        <i class="fas fa-plus mr-2"></i> 習慣を追加
      <% end %>
    </div>
  <% end %>
</div>

<!-- おやすみなさい -->
<section class="mb-4">
  <h2 class="text-2xl text-black [font-family:'Rounded_Mplus_1c-Black',Helvetica]">
    おやすみなさい！
  </h2>
</section>

<!-- 就寝ボタン -->
<section class="w-full">
  <% if @today_session&.return_home_at.blank? %>
    <button disabled
      class="block w-full bg-gray-300 border border-gray-300 rounded-xl py-3 text-2xl font-medium text-black shadow-sm cursor-not-allowed text-center [font-family:'Rounded_Mplus_1c-Regular',Helvetica]">
      就寝
    </button>
  <% elsif @today_session&.bedtime_at.blank? %>
    <% target_ids = current_user.habits.pluck(:id) %>
    <% if @today_session.all_habits_completed_today?(target_ids) %>
      <%= button_to "就寝", bedtime_daily_sessions_path,
          method: :post,
          class: "block w-full bg-[#67c2fa] rounded-xl py-3 text-2xl font-medium text-black hover:bg-[#4eb3f7] transition-colors [font-family:'Rounded_Mplus_1c-Medium',Helvetica]" %>
    <% else %>
      <button disabled
        class="block w-full bg-gray-300 border border-gray-300 rounded-xl py-3 text-2xl font-medium text-black shadow-sm cursor-not-allowed text-center [font-family:'Rounded_Mplus_1c-Regular',Helvetica]">
        就寝
      </button>
    <% end %>
  <% else %>
    <button disabled
      class="block w-full bg-gray-300 rounded-xl py-3 text-2xl font-medium text-black shadow-sm cursor-not-allowed text-center [font-family:'Rounded_Mplus_1c-Regular',Helvetica]">
      記録完了🌙
    </button>
  <% end %>
</section>
