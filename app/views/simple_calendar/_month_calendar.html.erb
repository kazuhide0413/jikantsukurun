<%# app/views/simple_calendar/_month_calendar.html.erb %>
<%= raw(
  content_tag(:div, class: "simple-calendar w-full") do
    # ðŸ“… æœˆã‚¿ã‚¤ãƒˆãƒ«
    content_tag(:div, start_date.strftime("%Yå¹´ %B"), class: "text-center text-lg font-semibold text-gray-800 mb-2") +

    # ðŸ—“ æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼ã¨æœ¬ä½“ãƒ†ãƒ¼ãƒ–ãƒ«
    content_tag(:table, class: "w-full table-fixed border-collapse text-sm text-center") do
      # ---- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæ—¥æ›œå§‹ã¾ã‚Šï¼‰----
      content_tag(:thead) do
        content_tag(:tr) do
          %w(æ—¥ æœˆ ç« æ°´ æœ¨ é‡‘ åœŸ).each_with_index.map do |day, i|
            klass = case i
              when 0 then "text-red-500"
              when 6 then "text-sky-500"
              else "text-gray-600"
            end
            content_tag(:th, day, class: "#{klass} pb-2")
          end.join.html_safe
        end
      end +

      # ---- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æœ¬ä½“ï¼ˆæ—¥æ›œå§‹ã¾ã‚Šãƒ»6è¡Œå›ºå®šï¼‰----
      content_tag(:tbody) do
        # ðŸ“† æœˆå…¨ä½“ã‚’ã€Œæ—¥æ›œå§‹ã¾ã‚Šã€œåœŸæ›œçµ‚ã‚ã‚Šã€ã§å–å¾—
        custom_range = (start_date.beginning_of_month.beginning_of_week(:sunday)..start_date.end_of_month.end_of_week(:sunday)).to_a

        # âœ… è¡Œæ•°ï¼ˆé€±æ•°ï¼‰ãŒ6æœªæº€ãªã‚‰æ¬¡æœˆã®æ—¥ã§åŸ‹ã‚ã‚‹
        if (custom_range.size / 7) < 6
          last_date = custom_range.last
          ((6 * 7) - custom_range.size).times do |i|
            custom_range << (last_date + (i + 1).days)
          end
        end

        # ðŸ“… å„é€±ã‚’1è¡Œãšã¤å‡ºåŠ›
        custom_range.each_slice(7).map do |week|
          content_tag(:tr) do
            week.map do |date|
              is_today = (date == Date.current)
              is_other_month = (date.month != start_date.month)

              content_tag(:td, class: "align-top p-1") do
                content_tag(:div,
                  class: "flex flex-col items-center justify-center
                          w-[46px] h-[46px] sm:w-[52px] sm:h-[52px]
                          rounded-lg mx-auto
                          #{'bg-sky-100 border border-sky-300' if is_today}") do

                  # æ—¥ä»˜
                  content_tag(:div,
                    date.day,
                    class: "font-bold text-sm #{day_text_color(date)} #{'text-gray-400' if is_other_month}"
                  ) +
                  # æœ‰åŠ¹æ™‚é–“
                  content_tag(:div,
                    passed_block.call(date),
                    class: "text-[10px] #{is_other_month ? 'text-gray-400' : 'text-gray-500'} mt-0.5 leading-tight"
                  )
                end
              end
            end.join.html_safe
          end
        end.join.html_safe
      end
    end
  end
) %>
